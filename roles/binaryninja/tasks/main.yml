---
- name: Binary ninja dependencies
  package:
    name:
      - unzip
    state: present
  become: yes

- name: Check for Binary ninja
  stat:
    path: '{{ binary_ninja_zip }}'
  register: binaryninja

- name: Get Binary ninja
  unarchive:
    src: '{{ binary_ninja_zip }}'
    mode: '0755'
    dest: '{{ tool_dir }}'
    creates: '{{ tool_dir }}/binaryninja/binaryninja'
  when: binaryninja.stat.exists

- name: Check for Binary ninja license
  stat:
    path: '{{ binary_ninja_license }}'
  register: binaryninja_license

- name: Make binaryninja config dir
  file:
    path: '{{ binary_ninja_config_dir }}'
    state: directory
    mode: '0755'
  when: binaryninja_license.stat.exists

- name: Install Binary ninja license
  copy:
    dest: '{{ binary_ninja_license_dest }}'
    src: '{{ binary_ninja_license }}'
    mode: '0644'
  when: binaryninja_license.stat.exists

- name: Setup Binary ninja
  command: ./linux-setup.sh
  args:
    chdir: '{{ tool_dir }}/binaryninja/scripts'

- name: Install Binary ninja API
  command: ./install_api.py
  args:
    chdir: '{{ tool_dir }}/binaryninja/scripts'

- name: Setup BinaryNinja i3 configuration.
  blockinfile:
    path: '{{ i3_config_location }}'
    marker: '# {mark} Adding BinaryNinja config'
    block: |
      assign [class="Binary Ninja"] $ws3
      bindsym $mod+n exec {{ tool_dir }}/binaryninja/binaryninja